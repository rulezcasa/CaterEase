{"ast":null,"code":"var _jsxFileName = \"/Volumes/Harish/food-ordering-app/src/components/PaymentForm.jsx\",\n    _s = $RefreshSig$();\n\nimport { CardElement, useElements, useStripe, Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { clearCart, cartProducts } from \"../stores/cart/cartSlice\";\nimport { getAddress, clearAddress } from \"../stores/userInfo/addressSlice\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useState, useEffect } from 'react';\nimport Button from \"./elements/Button\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\nexport const StripeWrapper = () => {\n  return /*#__PURE__*/_jsxDEV(Elements, {\n    stripe: stripePromise,\n    children: /*#__PURE__*/_jsxDEV(PaymentForm, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 14,\n    columnNumber: 9\n  }, this);\n};\n_c = StripeWrapper;\n\nconst PaymentForm = () => {\n  _s();\n\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const dispatch = useDispatch();\n  const cart = useSelector(cartProducts);\n  const address = useSelector(getAddress);\n  const navigate = useNavigate();\n  const elements = useElements();\n  const stripe = useStripe();\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n\n    if (!stripe || !elements || !(cart !== null && cart !== void 0 && cart.length) || !address) {\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const {\n        error: backeEndError,\n        clientSecret\n      } = await fetch('http://localhost:8080/create-payment-intent', {\n        method: 'POST',\n        headers: {\n          'Content-type': 'application/json'\n        },\n        body: JSON.stringify({\n          paymentMethodType: 'card',\n          orderItems: cart,\n          userId: '',\n          shippingAddress: address\n        })\n      }).then(r => r.json());\n      const {\n        error: stripeError,\n        paymentIntent\n      } = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: elements.getElement(CardElement)\n        }\n      });\n\n      if (backeEndError || stripeError) {\n        setError(backeEndError || stripeError);\n      } else if (paymentIntent.status === 'succeeded') {\n        dispatch(clearAddress());\n        dispatch(clearCart());\n        navigate('/payment-success');\n      }\n    } catch (err) {\n      console.log(err);\n    }\n\n    setLoading(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    className: \"md:-2/3 md:mx-auto px-2 pt-1\",\n    id: \"payment-form\",\n    onSubmit: handleSubmit,\n    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n      htmlFor: \"card-element\",\n      className: \"pt-4 text-2xl md:text-center\",\n      children: \"Please enter your card details\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"my-4\",\n      children: /*#__PURE__*/_jsxDEV(CardElement, {\n        id: \"card-element\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-center p-2\",\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        type: \"submit\",\n        disbled: loading,\n        children: loading ? 'Loading...' : 'Pay Now'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 74,\n    columnNumber: 9\n  }, this);\n};\n\n_s(PaymentForm, \"EHggIF5o2YoynycU3i5m9oBwldw=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useNavigate, useElements, useStripe];\n});\n\n_c2 = PaymentForm;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"StripeWrapper\");\n$RefreshReg$(_c2, \"PaymentForm\");","map":{"version":3,"names":["CardElement","useElements","useStripe","Elements","loadStripe","useSelector","useDispatch","clearCart","cartProducts","getAddress","clearAddress","useNavigate","useState","useEffect","Button","stripePromise","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","StripeWrapper","PaymentForm","loading","setLoading","error","setError","dispatch","cart","address","navigate","elements","stripe","handleSubmit","e","preventDefault","length","backeEndError","clientSecret","fetch","method","headers","body","JSON","stringify","paymentMethodType","orderItems","userId","shippingAddress","then","r","json","stripeError","paymentIntent","confirmCardPayment","payment_method","card","getElement","status","err","console","log"],"sources":["/Volumes/Harish/food-ordering-app/src/components/PaymentForm.jsx"],"sourcesContent":["import { CardElement, useElements, useStripe, Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { clearCart, cartProducts } from \"../stores/cart/cartSlice\";\nimport { getAddress, clearAddress } from \"../stores/userInfo/addressSlice\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useState, useEffect } from 'react';\nimport Button from \"./elements/Button\";\n\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY);\n\nexport const StripeWrapper = () => {\n    return (\n        <Elements stripe={stripePromise}>\n            <PaymentForm />\n        </Elements>\n    )\n}\nconst PaymentForm = () => {\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState(null);\n    const dispatch = useDispatch();\n    const cart = useSelector(cartProducts);\n    const address = useSelector(getAddress);\n    const navigate = useNavigate();\n    const elements = useElements();\n    const stripe = useStripe();\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n\n        if (!stripe || !elements || !cart?.length || !address) {\n            return;\n        }\n\n        setLoading(true);\n        try {\n            const { error: backeEndError, clientSecret } = await fetch('http://localhost:8080/create-payment-intent', {\n                method: 'POST',\n                headers: {\n                    'Content-type': 'application/json'\n                },\n                body: JSON.stringify({\n                    paymentMethodType: 'card',\n                    orderItems: cart,\n                    userId: '',\n                    shippingAddress: address\n                })\n            }).then(r => r.json());\n\n            const { error: stripeError, paymentIntent } = await stripe.confirmCardPayment(\n                clientSecret, {\n                    payment_method: {\n                        card: elements.getElement(CardElement)\n                    }\n                }\n            )\n            if (backeEndError || stripeError) {\n                setError(backeEndError || stripeError)\n            } else if (paymentIntent.status === 'succeeded') {\n                dispatch(clearAddress());\n                dispatch(clearCart());\n                navigate('/payment-success');\n            }\n\n        } catch(err) {\n            console.log(err);\n        }\n\n        setLoading(false);\n    }\n\n    return (\n        <form className=\"md:-2/3 md:mx-auto px-2 pt-1\" id=\"payment-form\" onSubmit={handleSubmit}>\n            <label htmlFor=\"card-element\" className=\"pt-4 text-2xl md:text-center\">Please enter your card details</label>\n            <div className=\"my-4\">\n                <CardElement id=\"card-element\" />\n            </div>\n            <div className=\"flex justify-center p-2\">\n                <Button type=\"submit\" disbled={loading}>\n                    {\n                        loading ?\n                        'Loading...' :\n                        'Pay Now'\n                    }\n                </Button>\n            </div>\n        </form>\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}